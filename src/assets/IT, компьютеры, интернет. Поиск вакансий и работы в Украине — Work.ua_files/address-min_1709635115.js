var mapStaticHost="//st.work.ua",Addresses={AddressMap:function(e){return{hide:function(){e.hide()},show:function(a){this.renderMapWithMarker(a,17),e.show()},renderMapWithMarker:function(a,s){a=window.encodeURIComponent(a.replace("&#039;",""));var t=$("<iframe />",{frameborder:0,style:"border:0",src:"https://www.google.com/maps/embed/v1/place?q="+a+"&zoom="+s+"&key="+window.google_maps_key+"&language="+Work.config.localeConfig.lang[window.lang.locale].languageCode});t.width("100%"),t.height(400),e.empty().append(t)}}},merge_options:function(e,a){var s={};for(var t in e)s[t]=e[t];for(var t in a)s[t]=a[t];return s},showAddressSelector:function(e,a,s){var t=$(this),o=window.lang.locale,n=a.modal&&a.modal.title||lang.address_modal.title_exception,d=a.modal&&a.modal.subTitle||lang.address_modal.sub_title,r=a.modal&&a.modal.cityTitle||lang.address_modal.address_selector,i=a.modal&&a.modal.buttonSave||lang.address_modal.save,l=a.modal&&a.modal.hideSubTitle||!1,c=void 0===a.showRequiredFieldMarker||a.showRequiredFieldMarker;if(e=cityObject(e||""),s=s||function(){},e){var u={title:n,own_body_el:'<div id="address-form">'+(l?'<p class="tips-anchor add-bottom-sm"></p>':'<p class="text-default-7 add-bottom-sm tips-anchor">'+d+"</p>")+'<label for="search-address" class="cut-bottom">'+r+" "+e[o+"_v1"]+(c?'<span class="text-danger" data-dismiss="modal">*</span>':"")+'</label><div class="flex sm:flex-nowrap flex-wrap"><div class="form-group w-100 add-top-xs add-bottom-response add-right cut-right-xs"><div class="input-holder"><input class="form-control" name="address" id="search-address" placeholder="'+lang.address_modal.address_placeholder+'"></div></div><div class="form-group add-top-xs cut-top-xs"><button id="search-address-btn" class="btn btn-default">'+lang.address_modal.address_button+"</button></div></div></div>",footer_buttons:[],closeLinkClasses:a.closeLinkClasses,closeFunc:function(){f.close()}},p=void 0===a.ajaxRequestType?"save":a.ajaxRequestType,f={init:function(){t.ModalBPWnd("options",u),t.ModalBPWnd("resetContent"),t.ModalBPWnd("setContent")},open:function(){t.ModalBPWnd("open")},close:function(){$("#search-address").val(""),h.reset()},setFooter:function(){u.footer_buttons=[{name:i,type:"button",close_on_click:1,func:function(){var e={};e[p]=h.value(),save(e,s)}}],t.ModalBPWnd("options",u),t.ModalBPWnd("setFooter")},clearFooter:function(){t.ModalBPWnd("cleanFooter")}};t.ModalBPWnd(u),f.clearFooter(),f.init();var h=new Addresses.Address(e,Addresses.merge_options(a.address,{onVariants:function(){f.setFooter()},onReset:function(){f.clearFooter()}}));h.init(),a.modal&&a.modal.withTips&&h.tips(),h.events(),h.enable(),f.open()}else s(null)},showFullAddressSelector:function(e,a,s){var t=$(this),o=window.lang.locale,n=a.modal&&a.modal.title||lang.address_modal.title_full,d=a.modal&&a.modal.subTitle||lang.address_modal.short_sub_title,r=a.modal&&a.modal.label||lang.address_modal.full_address_selector,i=a.modal&&a.modal.buttonSave||lang.address_modal.search_job_button;s=s||function(){};var l={title:n,own_body_el:'<div id="address-form-group" class=""><p class="text-default-7 add-bottom-sm tips-anchor">'+d+'</p><div id="address-form"><label class="cut-bottom">'+r+'</label><div class="form-group add-top-xs"><div class="input-holder input-size-sm"><input class="form-control search-city" name="city" id="search_city" autocomplete="off" placeholder="'+lang.address_modal.city_placeholder+'"><div class="icon-stack"><a href="javascript:;" class="link-close js-region-reset hidden" tabindex="-1"><span class="glyphicon glyphicon-remove"></span></a></div><input type="hidden" class="js-rvalue" id="city_id" name="region" tabindex="-1" value=""></div></div><div class="flex sm:flex-nowrap flex-wrap"><div class="form-group add-top-xs add-bottom-response add-right cut-right-xs w-100"><div class="input-holder"><input class="form-control" name="address" id="search-address" placeholder="'+lang.address_modal.address_placeholder+'"></div></div><div class="form-group add-top-xs cut-top-xs"><button id="search-address-btn" class="btn btn-default">'+lang.address_modal.address_button+"</button></div></div></div>",footer_buttons:[],closeLinkClasses:a.closeLinkClasses,closeFunc:function(){u.close()}},c=void 0===a.ajaxRequestType?"save":a.ajaxRequestType,u={init:function(){t.ModalBPWnd("options",l),t.ModalBPWnd("resetContent"),t.ModalBPWnd("setContent")},open:function(){t.ModalBPWnd("open")},close:function(){$("#search-address").val(""),p.reset()},setFooter:function(){l.footer_buttons=[{name:i,type:"button",close_on_click:1,func:function(){var e={};e[c]=p.value(),save(e,s)}}],t.ModalBPWnd("options",l),t.ModalBPWnd("setFooter")},clearFooter:function(){t.ModalBPWnd("cleanFooter")}};t.ModalBPWnd(l),u.clearFooter(),u.init();var p=new Addresses.Address(e,Addresses.merge_options(a.address,{modalWithoutCityInput:!0,onVariants:function(){u.setFooter()},onReset:function(){u.clearFooter()}}));p.init(),p.tips(),p.events(),u.open();var f=$(".search-city"),h=$("#city_id"),g=$("#search-address"),v=function(){var e=cityObject(h.val());f.val()&&parseInt(h.val())?p.enable():p.disable(),e&&void 0!==e[o+"_old"]&&f.val(e[o])},m=parseInt(h.val()),_=function(e){m!==parseInt(h.val())&&(f.val()&&parseInt(h.val())?(p.changeLocation(cityObject(h.val())),m=parseInt(h.val())):(m=0,p.reset()),v(),setTimeout((function(){g.val("").focus()}),100))};f.on("change",_),f.on("blur",(function(){setTimeout(_,100)})),f.on("input",(function(){p.reset(),g.val(""),h.val(0),v()})),window.cities_activated=0,f.citySuggest({towns:!0,skipOccupiedTowns:1,withoutRemote:!0}),v()},getFullQueryString:function(e,a){return a+", "+e},Address:function(e,a){e=e||[];var s,t,o,n,d=(a=a||{}).container||"#address-form",r=a.button||"#search-address-btn",i=a.input||"#search-address",l=a.preload||null,c=a.tipsAnchor||".tips-anchor",u=a.modalWithoutCityInput||!1,p=a.error&&a.error.content||null,f=a.error&&a.error.input||lang.address_modal.input_error,h=(a.errorLinkEvent,window.lang.locale),g=a.onSearch||function(){},v=a.onAddressChange||function(){},m=a.onVariants||function(){},_=a.onVariantsChange||function(){},b=a.onReset||function(){},y=[],w=[],k=$("<img />",{src:"/static/i/spinner_grey.gif",width:"35",height:"35",class:"block",style:"margin-top: 2px"}),x={blue:function(){$(r).removeClass("disabled")},white:function(){$(r).addClass("disabled")}},A=!1,j=function(){A=!0,L(),$(i).val(lang.address_modal.loading)},S=function(){A=!1,B(),k.detach(),$(i).val("")},C={show:function(a,s){s=s?$("<h2 />").aapend(s):$("<h2 />").append(lang.address_modal.address_not_found),a=a?$("<p />").append(a):p?$("<p />").append(p):$("<p />",{text:lang.address_modal.address_not_found_more.replace("{0}",e[h+"_v1"])+" "}).append($("<a />",{href:"javascript:void(0)",text:lang.address_modal.address_not_found_link}).on("click",(function(e){e.preventDefault(),Addresses.setTownCenterGeolocation()}))).append("."),$("#address-error").empty().append(s).append(a).show()},hide:function(){$("#address-error").hide()}},T=function(e){if(e)var a=$("<p />",{class:"text-danger",text:e});else a=$("<p />",{class:"text-danger",text:f}).append(".");$(i).parent().addClass("has-danger").append(a),s&&s.hide()},M=function(){$(i).parent().removeClass("has-danger").find("p.text-danger").remove(),s&&s.show()},P=function(){b(),C.hide(),A=!1,k.detach(),M(),o.hide(),x.blue(),W()},F=function(){var e=$("#address-variants-values");if(e.empty(),w.length>1){var a=$("#address-variants");for(var s in a.show(),w)if(w.hasOwnProperty(s)){var t=$("<input />",{name:"address_variant",type:"radio",value:s}).prop("checked",0===parseInt(s)),n=$("<label />").append(t).append(w[s].formatted_address),d=$("<div />",{class:"radio"}).append(n);e.append($("<div />",{class:"radio"}).append(d))}a.find("input").off("change").on("change",(function(){var e=$(this).val();o.show(Addresses.getFullQueryString(w[e].town_name,w[e].formatted_address)),x.white(),_(w[e])}))}m(w)},W=function(){$("#address-variants").hide(),$("#address-variants-values").empty(),w=[]},I=function(){t&&t.detach(),$("#search-address-tips").remove(),s=$("<div />",{id:"search-address-tips",class:"text-muted add-top-sm js-tips-block"}),e["center_"+lang.locale]&&(s.append(lang.address_modal.for_example+" "),$("<a />",{href:"#",id:"city-center-address",class:"border-dashed-grey no-decoration",text:e["center_"+lang.locale]}).appendTo(s).on("click",(function(e){return $(i).trigger("input").val($(this).text()).focus(),!1})));var a=$(".form-group-large").find(".input-holder");"geolocation"in navigator&&!u&&(a.find("#here").remove(),a.append('<a id="here" href="#" class="link-geo-input"><span class="glyphicon glyphicon-geolocation"></span></a>').find("#here").on("click",(function(e){e.preventDefault(),A||(P(),j(),Addresses.autodetectGeolocation((function(e){S(),e&&!e.error&&$(i).trigger("input").val(e[0].formatted_address).focus(),e?e.error&&(P(),T(lang.address_modal.geolocation_error)):(P(),C.show(lang.address_modal.geolocation))})))}))),t=$("<div />",{class:"text-muted add-top-sm js-tips-block"}),"geolocation"in navigator&&!u&&t.append($("<span />",{text:lang.address_modal.here})),t&&$(c).after(t)},L=function(){$(i).val(""),$(i).prop("disabled",!0).addClass("disabled"),$(r).prop("disabled",!0).addClass("disabled"),$(i).parents('[class^="form-inline"]').addClass("disabled"),navigator,s&&s.detach(),t&&$(c).after(t)},B=function(){$(i).prop("disabled",!1).removeClass("disabled"),$(r).prop("disabled",!1).removeClass("disabled"),$(i).parents('[class^="form-inline"]').removeClass("disabled"),"geolocation"in navigator&&$(i).after(n),t&&t.detach(),s&&$(d).after(s)};return{init:function(){var e,a,s;e=$("<div />",{id:"address-variants",class:"form-group"}).hide().append($("<label />",{text:lang.address_modal.refinement})).append($("<div />",{id:"address-variants-values",class:"has-indent"})),a=$("<div />",{id:"address-map",class:"map-frame"}).hide(),s=$("<div />",{id:"address-error",class:"alert alert-danger add-top",style:"margin-bottom: 0"}).hide(),$(d).after(s).after(a).after(e)},tips:I,events:function(){var a;o=Addresses.AddressMap($("#address-map")),(a=parseInt(l))?$.ajax({type:"POST",url:"/_data/_ajax/addresses.php",cache:!1,dataType:"json",data:{get:a},success:function(e){g(w=[e]||[]),F(),o.show(Addresses.getFullQueryString(e.town_name,e.formatted_address))}}):x.blue(),$("#search-address").off("input").on("input",(function(){v(),P()})).off("keyup").on("keyup",(function(e){M(),e.preventDefault(),13===e.keyCode&&$(r).trigger("click")})),$(r).off("click").on("click",function(e,a,s){var t,o,n,d=null,r=0;s||(s={});var i=function(){r=!1===s.leading?0:Date.now(),d=null,n=e.apply(t,o),d||(t=o=null)};return function(){var l=Date.now();r||!1!==s.leading||(r=l);var c=a-(l-r);return t=this,o=arguments,c<=0||c>a?(d&&(clearTimeout(d),d=null),r=l,n=e.apply(t,o),d||(t=o=null)):d||!1===s.trailing||(d=setTimeout(i,c)),n}}((function(){M();var a=$(i).val().trim(),s=$("#address-variants-values").find("input:checked").val(),t=w[s||0];return a.length?(!t&&!$("#address-error").is(":visible")||!a)&&(y.push(a),void(A||$.ajax({type:"POST",url:"/_data/_ajax/addresses.php",cache:!1,dataType:"json",data:{query:Addresses.getFullQueryString(e[h],a),city:e[h],cityId:e.id},beforeSend:function(){A=!0,$(r).prop("disabled",!0)},success:function(s){if(s&&s.error)C.show();else if(w=s||[],g(s),1===s.length)$(i).val(s[0].formatted_address),F(),o.show(Addresses.getFullQueryString(s[0].town_name,s[0].formatted_address));else if(s.length>1)F(),o.show(Addresses.getFullQueryString(s[0].town_name,s[0].formatted_address));else{"undefined"==typeof sessionStorage&&(sessionStorage={getItem:function(){},setItem:function(){}});var t=sessionStorage.getItem("address")&&Array.isArray(sessionStorage.getItem("address"))?JSON.parse(sessionStorage.getItem("address"))[0].formatted_address:null;C.hide(),a===t?C.show(lang.address_modal.address_not_found_auto.replace("{0}",e[h+"_v1"])):C.show()}},complete:function(){$(r).prop("disabled",!1),x.white(),A=!1}}))):(T(),!1)}),1e3))},reset:function(){P()},error:{hide:C.hide,show:C.show},changeLocation:function(a){e=a,I(),P()},disable:L,enable:B,value:function(){var e=$("#address-variants-values").find("input:checked").val(),a=w[e||0];if(a)return a.query_string=JSON.stringify(y),a}}},beforeRedirectCallback:function(e,a){},setBeforeRedirectCallback:function(e){this.beforeRedirectCallback=e},showPopupWithChoosingAddress:function(e){this.$changeAddressLink=$(e),this.$changeAddressLink.closest("div.popover").remove();var a,s=this.$changeAddressLink.data("config-city"),t=this.$changeAddressLink.attr("href");Addresses.showAddressSelector(s,{ajaxRequestType:"changeAddress",address:{error:{input:lang.address_modal.input_error_v3}},showRequiredFieldMarker:!1,closeLinkClasses:this.$changeAddressLink.data("analytics-jobseeker-close-modal")},(function(e){a=e,window.location.href=t})),Addresses.beforeRedirectCallback(Addresses.$changeAddressLink,a)},showPopupWithSelectAddress:function(e){var a=$(".input-search-city .js-rvalue"),s=$(".js-near-home-city-id"),t=$("#sm-but");Addresses.showFullAddressSelector(null,{ajaxRequestType:"changeAddress",address:{error:{input:lang.address_modal.input_error_v3}},closeLinkClasses:e.popupCloseLinkClasses},(function(e){e.region&&(a.val(e.region),s.val(e.region)),t.trigger("click")}))},setTownCenterGeolocation:function(){var e=this.$changeAddressLink?this.$changeAddressLink.attr("href"):"",a=this.$changeAddressLink.data("config-city");$.ajax({type:"POST",url:"/_data/_ajax/addresses.php",cache:!1,dataType:"json",data:{setTownCenterGeolocation:a},success:function(a){window.location.href=e}})},autodetectGeolocation:function(e){if(e=e||function(){},"geolocation"in navigator){"undefined"==typeof sessionStorage&&(sessionStorage={getItem:function(){},setItem:function(){}});var a=sessionStorage.getItem("address");a&&"0"!==a?e(JSON.parse(a)):navigator.geolocation.getCurrentPosition((function(a){var s=a.coords.latitude,t=a.coords.longitude;$.ajax({type:"POST",url:"/_data/_ajax/addresses.php",cache:!1,dataType:"json",data:{searchAndSave:0,query:[s,t]},success:function(a){sessionStorage.setItem("address",JSON.stringify(a)),e(a)}})}),(function(){sessionStorage.setItem("address","0"),e()}),{maximumAge:15e3})}else e()},autodetectGeolocationWithSave:function(e){e=e||function(){},"geolocation"in navigator?navigator.geolocation.getCurrentPosition((function(a){var s=a.coords.latitude,t=a.coords.longitude;$.ajax({type:"POST",url:"/_data/_ajax/addresses.php",cache:!1,dataType:"json",data:{searchAndSave:1,query:[s,t]},success:e})}),(function(){e()}),{maximumAge:15e3}):e()},initToggleMap:function(e,a,s){var t=$(e);t.toggleHiddenBlock(),t.click((function(){void 0===window.jobAddressMap&&(jobAddressMap=Addresses.AddressMap($(a)),jobAddressMap.renderMapWithMarker(s.address,s.zoom))}))}};function cityObject(e){var a=null;for(var s in citiesTH){if(citiesTH.hasOwnProperty(s))for(var t in citiesTH[s])if(citiesTH[s].hasOwnProperty(t)&&(citiesTH[s][t]===e||parseInt(citiesTH[s][t])===e)){a=citiesTH[s];break}if(a)break}return a}function save(e,a){$.ajax({type:"POST",url:"/_data/_ajax/addresses.php",cache:!1,dataType:"json",data:e,success:function(e){e&&e.error?a():a(e)}})}